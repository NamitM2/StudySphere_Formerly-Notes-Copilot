          width: Math.abs(x2 - x1),
          height: Math.abs(y2 - y1)
        });
      }
    }

    const scaleFactor = viewportRef.current?.scale || scale || 1;
    return applyDpiScale({
      left: leftPdf * scaleFactor,
      top: (pdfHeight - topPdf) * scaleFactor,
      width: (rightPdf - leftPdf) * scaleFactor,
      height: (topPdf - bottomPdf) * scaleFactor
    });
  };

if (loading) {
    return (
      <div className="flex items-center justify-center h-96 bg-zinc-950 rounded-lg border border-zinc-800">
        <div className="text-center">
          <LoadingLogo size="lg" />
          <p className="text-zinc-400 mt-4">Loading worksheet...</p>
        </div>
      </div>
    );
  }

  if (!pdf) {
    return (
      <div className="flex items-center justify-center h-96 bg-zinc-950 rounded-lg border border-zinc-800">
        <div className="text-center px-6">
          <svg className="w-16 h-16 mx-auto mb-4 text-zinc-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
          </svg>
          <p className="text-zinc-400 mb-2">No worksheet loaded</p>
          <p className="text-xs text-zinc-600">The PDF worksheet is only available during this session.</p>
          <p className="text-xs text-zinc-600 mt-1">To reload it, please upload the PDF file again.</p>
        </div>
      </div>
    );
  }

